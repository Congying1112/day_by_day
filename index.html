<!DOCTYPE html>
<!-- saved from url=(0069)https://fullcalendar.io/js/fullcalendar-3.1.0/demos/agenda-views.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
body {
	margin: 40px 10px;
	padding: 0;
	font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
	font-size: 14px;
}
</style>

<link rel="stylesheet" href="./index_files/webix/codebase/webix.css" type="text/css" charset="utf-8">
<script src="./index_files/webix/codebase/webix.js" type="text/javascript" charset="utf-8"></script>

<script src="./config/tasks.js"></script>
<script src="./data/tasks.js"></script>

<script src="./config/days.js"></script>
<script src="./data/days.js"></script>

<link href="./index_files/fullcalendar.min.css" rel="stylesheet">
<link href="./index_files/fullcalendar.print.min.css" rel="stylesheet" media="print">
<script src="./index_files/moment.min.js"></script>
<script src="./index_files/jquery.min.js"></script>
<script src="./index_files/fullcalendar.min.js"></script>
<script src="./config/calendar.js"></script>
<script src="./data/diaries.js"></script>
<script src="./data/events.js"></script>
<style>
	body {
		margin: 40px 10px;
		padding: 0;
		font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
		font-size: 14px;
	}
	#calendar, #tasks, #days {
		max-width: 900px;
		/*margin: 0 auto;*/
	}
	.day-good {
    	background-color: green;
	}
	.day-bad {
	    background-color: red;
	}
	.day-common{
	    background-color: blue;
	}
</style>
<script>
	webix.ready(function(){
		function get_total(data, hour_name){
			if(data.data == undefined) {
				if (data[hour_name] == undefined)
					data[hour_name] = 0;
			} else if(data[hour_name] == undefined){
				var hour = 0;
				data.data.forEach((sub_data)=>{
					hour += get_total(sub_data, hour_name)
				});
				data[hour_name] = hour;
			}
			else {
				//
			}
			return data[hour_name];
		}
		function filfull_data(data, col_name, func){
			if(data[col_name] == undefined) {
				data[col_name] = func(data)
			}
			if(data.data != undefined) {
				data.data.forEach((sub_data)=>{
					filfull_data(sub_data, col_name, func);
				});
			}
		}
		// tasks
		tasks.forEach((task)=>{
			get_total(task, "hours_needed")
			get_total(task, "hours_used")
			filfull_data(task, "hours_left", (data)=>{
				return data.hours_needed - data.hours_used;
			});
		});
		tasks_config.container = "tasks"
		tasks_config.data = tasks
		grida = webix.ui(tasks_config);	

		// days
		var days_summary = {
			"class": "小计",
			"total_hours": 0,
			"used_hours": 0
		}
		days.forEach((day)=>{
			filfull_data(day, "left_count", (data)=>{
				return data.total_count - data.used_count;
			});

			filfull_data(day, "total_hours", (data)=>{
				return data.available_by_unit * data.total_count;
			});
			filfull_data(day, "used_hours", (data)=>{
				return data.available_by_unit * data.used_count;
			});

			filfull_data(day, "left_hours", (data)=>{
				return data.total_hours - data.used_hours;
			});
			days_summary.total_hours += day.total_hours
			days_summary.used_hours += day.used_hours
		});
		days_summary.left_hours = days_summary.total_hours - days_summary.used_hours
		days.push(days_summary)
		days_config.container = "days"
		days_config.data = days
		grida = webix.ui(days_config);	
	});

	$(document).ready(function() {
		calendar_config.eventSources = [
			{
				events: diaries
			},
			{
				events: events
			}
		]
		$('#calendar').fullCalendar(calendar_config);
	});
</script>
</head>
<body>
<hr>
TASKS
<hr>
<div id="tasks"></div>	
<hr>
<hr>
DAYS
<hr>
<div id="days"></div>	
<hr>
<hr>
CALENDER
<hr>
<div id='calendar'></div>
</body>
</html>